# Mesto

## Задание 1

Разделение на микрофронтенды.

### Уровень 1. Проектирование

#### Этап 1. Предварительный анализ

На текущий момент приложение не отличается высокой сложностью, однако, сложность со временем, как правило, растет.
И уже достаточно скоро логика приложения может стать гораздо богаче, приложение обрастет новыми фичами, вырастет колличество команд над ним работающих.
Для обеспечения высоких темпов разработки, масштабирования, отказоустойчивости есть необходимость разделить монолитный фронтенд на микрофронтенды.

#### Этап 2. Стратегия реализации

В качестве стратегии реализации можно выбрать "вертикальную нарезку"

Руководствуясь принципами DDD можно выделить несколько ключевых бизнес-функций:
- identity: регистрация/аутентификация
- profile: профиль пользователя, его аватарка, имя, описание
- catalogue: карточки с фото, кол-во лайков под ними

Это так же может обеспечить автономность команд и изоляцию.

#### Этап 3. Метод реализации

В качестве метода интеграции микрофронтендов логично выбрать run time метод, т.к. обеспечивает высокою гибкость, независимость развертывания.
Т.к. в приложении много интерактивного контента лучшим выбором будет объединение компонентов на клиентской стороне, которую можно обеспечить ленивой (lazy) подгрузкой.

#### Этап 4. Инструмент

Для реализации задачи разделения можно рассмотреть самые популярные фреймворки: Single SPA и Webpack Module Federation.
Оба фреймворка отвечают всем перечисленным на предыдущих этапах требованиям, выбор - дело предпочтения и/или наличия экспертизы в командах.
В качестве фреймворка для реализации микрофронтендов был выбран Webpack Module Federation.

#### Этап 5. Межмодульное взаимодействие.
 
На первый взгляд кажется, что в том виде, в котором приложение находится сейчас вполне достаточно было бы коммуникации между компонентами через API, т.к. компоненты не сильно зависят друг от друга.

И если профиль пользователя, действительно, "живет" отдельно со всей информацией о себе, то для отображения каталога нужно, как минимум, знать принадлежность фото к текущему пользователю (кнопка удалить), а так же есть ли на конкретной карточке лайк от текущего пользователя.
Кроме того логика и связи могут усложниться в дальнейшем: могут появиться комментарии под фотокарточками, избранное и т.д.
Поэтому оптимальным вариантом было бы сразу пойти в межкомпонентное взаимодействие через глобальное состояние. Для этого можно взять, например, Redux.

#### Итого

Мы разделяем монолитный фронтенд на следующие микрофронтенды:

- host: корневой компонент с header, footer и т.д.
- identity: компонент регистрации и авторизации пользователя
- profile: компонент отображения и редактирования профиля пользователя
- catalogue: компонент отображения, добавления, лайка для фотокарточек

компоненты собираются с помощью Webpack Module Federation в runtime и имеют глобальное состояние через Redux

### Уровень 2. Планирование изменений

В итоге у нас будет примерно такая структура каталогов:

``` sh
❯ tree . -L 4
.
├── catalogue
│   ├── src
│   │   ├── blocks
│   │   │   ├── card
│   │   │   └── places
│   │   └── components
│   │       ├── AddPlacePopup.js
│   │       ├── Card.js
│   │       └── ImagePopup.js
│   └── webpack.config.js
├── host
│   ├── src
│   │   ├── blocks
│   │   │   ├── content
│   │   │   ├── footer
│   │   │   ├── header
│   │   │   └── page
│   │   ├── components
│   │   │   ├── App.js
│   │   │   ├── Footer.js
│   │   │   ├── Header.js
│   │   │   ├── Main.js // Отсюда следует вынести компонент Profile, только подгружать его из соседнего микрофронта. Можно так же список карточек вынести отдельно
│   │   │   └── ProtectedRoute.js
│   │   ├── images
│   │   ├── index.css
│   │   ├── index.js
│   │   ├── logo.svg
│   │   └── utils
│   │       └── api.js
│   └── webpack.config.js
├── identity
│   ├── src
│   │   ├── blocks
│   │   │   ├── auth-form
│   │   │   └── login
│   │   ├── components
│   │   │   ├── InfoTooltip.js
│   │   │   ├── Login.js
│   │   │   └── Register.js
│   │   └── utils
│   │       └── auth.js
│   └── webpack.config.js
├── profile
│   ├── src
│   │   ├── blocks
│   │   │   └── profile
│   │   └── components
│   │       ├── EditAvatarPopup.js
│   │       ├── EditProfilePopup.js
│   │       └── Profile.js // этого компонента нет в исходном коде, но его следует вынести из компонента Main в host-е, чтоб можно было переисаользовать в других местах
│   └── webpack.config.js
└── shared
    └── src
        ├── blocks
        │   └── popup
        └── components
            └── PopupWithForm.js
```
